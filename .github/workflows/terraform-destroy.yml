name : 'DigitalOcean destroy'

on:
  workflow_dispatch:
jobs:
    droplet:
      name: 'Destroy Droplet'
      runs-on: ubuntu-latest
      defaults:
        run:
          shell: bash

      steps:
        # Checkout the repository to the GitHub Actions runner
        - name: Checkout
          uses: actions/checkout@v2

        # Install the latest version of Terraform CLI and configure the Terraform CLI configuration file with a Terraform Cloud user API token
        - name: Setup Terraform
          uses: hashicorp/setup-terraform@v1
          with:
            cli_config_credentials_token: ${{ secrets.TF_API_TOKEN }}

        # Initialize a new or existing Terraform working directory by creating initial files, loading any remote state, downloading modules, etc.
        - name: Terraform Init
          working-directory: ./digitalocean
          run: terraform init

        # Generates an execution plan for Terraform
        - name: Terraform destroy
          working-directory: ./digitalocean
          run: terraform destroy -var "do_token=${{ env.do_token }}"